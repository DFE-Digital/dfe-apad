{% extends 'layout.html' %}

{% set allClassesQuery = (data['p-lodged-all'] | int) > [data['p-withdrawn-all'], data['p-heard-all']] | stringSum %}
{% set allClassesError = (data['p-lodged-all'] | int) < [data['p-withdrawn-all'], data['p-heard-all']] | stringSum %}

{% set allClassesFine = not allClassesQuery and not allClassesError %}

{% set infantClassesQuery = (data['p-lodged-infant'] | int) > [data['p-withdrawn-infant'], data['p-heard-infant']] | stringSum %}
{% set infantClassesError = (data['p-lodged-infant'] | int) < [data['p-withdrawn-infant'], data['p-heard-infant']] | stringSum %}

{% set infantClassesFine = not infantClassesQuery and not infantClassesError %}

{% block pageTitle %}
    Check the total number of appeals
{% endblock %}

{% block beforeContent %}

    {{ govukBackLink ({
        text: 'Back',
        href: 'javascript:history.back()'
    }) }}

{% endblock %}

{% block content %}

<div class="govuk-grid-row">

        <div class="govuk-grid-column-two-thirds">

            <form action="{{ 'check-outcomes.html' if data['from-p-outcome-totals'] == 'true' else 'in-favour.html' }}">

                <span class="govuk-caption-xl">Primary schools</span>
                <h1 class="govuk-heading-xl">Check the appeals that were withdrawn or heard by an appeals panel against the total that were lodged</h1>

                <h2 class="govuk-heading-m">All classes</h2>

                {{ govukSummaryList ({
                    rows: [
                        {
                            key: {
                                text: 'Withdrawn'
                            },
                            value: {
                                text: data['p-withdrawn-all']
                            },
                            actions: {
                                items: [
                                    {
                                        text: 'Change',
                                        href: 'withdrawn.html?from-p-lodged-totals=true',
                                        visuallyHiddenText: 'withdrawn'
                                    }
                                ]
                            }
                        },
                        {
                            key: {
                                text: 'Heard'
                            },
                            value: {
                                text: data['p-heard-all']
                            },
                            actions: {
                                items: [
                                    {
                                        text: 'Change',
                                        href: 'heard.html?from-p-lodged-totals=true',
                                        visuallyHiddenText: 'heard'
                                    }
                                ]
                            }
                        },
                        {
                            key: {
                                text: 'Total actioned'
                            },
                            value: {
                                text: [data['p-withdrawn-all'], data['p-heard-all']] | stringSum
                            }
                        }
                    }
                }) }}

                {{ govukSummaryList ({
                    rows: [
                        {
                            key: {
                                text: 'Total lodged'
                            },
                            value: {
                                text: data['p-lodged-all']
                            },
                            actions: {
                                items: [
                                    {
                                        text: 'Change',
                                        href: 'lodged.html?from-p-lodged-totals=true',
                                        visuallyHiddenText: 'total lodged'
                                    }
                                ]
                            }
                        }
                    }
                }) }}

                {% if not allClassesFine %}

                    {% if allClassesQuery %}

                        {% if not allClassesError and not infantClassesError %}

                            {{ govukTextarea({
                                id: 'p-lodged-query-all',
                                name: 'p-lodged-query-all',
                                value: data['p-lodged-query-all'] if data['p-lodged-query-all'] else '',
                                label: {
                                    text: 'Explain why there were ' + (data['p-lodged-all'] | int - [data['p-withdrawn-all'], data['p-heard-all']] | stringSum) + ' unresolved appeals for all classes'
                                }
                            }) }}

                        {% endif %}

                    {% endif %}

                    {% if allClassesError %}

                        {{ govukErrorMessage({
                            text: 'There cannot be more appeals actioned than the total number lodged, you must fix this before you can continue',
                            visuallyHiddenText: 'Error'
                        }) }}

                    {% endif %}

                {% endif %}

                <h2 class="govuk-heading-m">Infant classes</h2>

                {{ govukSummaryList ({
                    rows: [
                        {
                            key: {
                                text: 'Withdrawn'
                            },
                            value: {
                                text: data['p-withdrawn-infant']
                            },
                            actions: {
                                items: [
                                    {
                                        text: 'Change',
                                        href: 'withdrawn.html?from-p-lodged-totals=true',
                                        visuallyHiddenText: 'withdrawn'
                                    }
                                ]
                            }
                        },
                        {
                            key: {
                                text: 'Heard'
                            },
                            value: {
                                text: data['p-heard-infant']
                            },
                            actions: {
                                items: [
                                    {
                                        text: 'Change',
                                        href: 'heard.html?from-p-lodged-totals=true',
                                        visuallyHiddenText: 'heard'
                                    }
                                ]
                            }
                        },
                        {
                            key: {
                                text: 'Total actioned'
                            },
                            value: {
                                text: [data['p-withdrawn-infant'], data['p-heard-infant']] | stringSum
                            }
                        }
                    }
                }) }}

                {{ govukSummaryList ({
                    rows: [
                        {
                            key: {
                                text: 'Total lodged'
                            },
                            value: {
                                text: data['p-lodged-infant']
                            },
                            actions: {
                                items: [
                                    {
                                        text: 'Change',
                                        href: 'lodged.html?from-p-lodged-totals=true',
                                        visuallyHiddenText: 'total lodged'
                                    }
                                ]
                            }
                        }
                    }
                }) }}

                {% if not infantClassesFine %}

                    {% if infantClassesQuery %}

                        {% if not allClassesError and not infantClassesError %}

                            {{ govukTextarea({
                                id: 'p-lodged-query-infant',
                                name: 'p-lodged-query-infant',
                                value: data['p-lodged-query-infant'] if data['p-lodged-query-infant'] else '',
                                label: {
                                    text: 'Explain why there were ' + (data['p-lodged-infant'] | int - [data['p-withdrawn-infant'], data['p-heard-infant']] | stringSum) + ' unresolved appeals for infant classes'
                                }
                            }) }}

                        {% endif %}

                    {% endif %}

                    {% if infantClassesError %}

                        {{ govukErrorMessage({
                            text: 'There cannot be more appeals actioned than the total number lodged, you must fix this before you can continue',
                            visuallyHiddenText: 'Error'
                        }) }}

                    {% endif %}

                {% endif %}
                
                {% if not allClassesError and not infantClassesError %}

                    {{ govukButton ({
                        html: 'Continue'
                    }) }}

                {% endif %}

            </form>

        </div>

</div>

{% endblock %}